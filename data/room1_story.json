{
  "roomId": 1,
  "roomName": "관측실",
  "phase": 0,
  
  "roomMeta": {
    "setting": "버려진 연구 시설의 메인 로비. 형광등이 깜빡이고 물 떨어지는 소리만 들린다.",
    "anomaly": "CCTV 화면을 3초 이상 응시하면 '그것'이 당신을 인식한다.",
    "contribution": "CCTV 조각, 지도 조각, 제단 조각 중 하나를 획득하여 기부할 수 있다."
  },
  
  "structure": {
    "hub": "n1",
    "spokes": {
      "cam_route": ["n3", "n7", "n8"],
      "map_route": ["n2", "n5", "n11", "n12"],
      "blood_route": ["n4", "n9", "n10", "n13", "n18"]
    },
    "merge": ["n15"],
    "exit": ["n19"],
    "deaths": ["n1_d1", "n2_d1", "n3_d1", "n4_d1", "n6_d1", "n8_d1", "n9_d1", "n10_d1", "n14_d1", "n15_d1", "n16_d1", "n17_d1", "n18_d1"]
  },
  
  "fx": {
    "base": "r1_bg",
    "overlays": {
      "phase0": null,
      "phase1": "vhs_scanline",
      "phase2": "vhs_glitch",
      "taint": "blood_drip",
      "purity": "clean_glow"
    }
  },
  
  "phaseVariants": {
    "1": {
      "nodeOverrides": {
        "n3": {
          "text": "모니터들이 강하게 빛난다. 화면에서 이상한 패턴이 반복된다. 규칙이 바뀌었다: 화면을 1초라도 보면 위험하다. [Phase 1: CCTV 위험도 상승]",
          "choices": [
            {
              "label": "모니터를 흘끗 본다",
              "type": "death",
              "deathType": "RULE_VIOLATION",
              "deathMsg": "Phase 1 규칙: CCTV 화면은 쳐다보지 말 것. 순간의 실수였다.",
              "globalEffect": { "tracks": { "taint": 3 } }
            },
            {
              "label": "눈을 감고 전원을 끈다",
              "type": "goto",
              "next": "n7",
              "effects": { "addItems": ["cam_shard"] },
              "globalEffect": { "tracks": { "purity": 2 } }
            }
          ]
        }
      },
      "ruleChanges": ["CCTV 화면은 절대 쳐다보지 말 것 (1초도 안 됨)"]
    },
    "2": {
      "nodeOverrides": {
        "n18": {
          "text": "제단이 강하게 빛난다. 여기서 기부하면 2배의 가치를 얻는다. 하지만 위험도 2배. [Phase 2: 고위험 고보상]",
          "choices": [
            {
              "label": "제단에 조각을 바친다 (즉시 기부 x2)",
              "type": "special_deposit",
              "multiplier": 2,
              "next": "n15",
              "requires": { "hasAnyShard": true },
              "globalEffect": { "tracks": { "sacrifice": 5 } }
            },
            {
              "label": "제단에 피를 바친다",
              "type": "death",
              "deathType": "SACRIFICE",
              "deathMsg": "제단이 당신의 희생을 받아들였다. 전역 progress +10.",
              "globalEffect": { "tracks": { "sacrifice": 10 }, "progress": 10 }
            },
            {
              "label": "피하고 돌아간다",
              "type": "goto",
              "next": "n15"
            }
          ]
        }
      },
      "ruleChanges": ["제단에서의 희생은 2배의 가치를 지닌다"]
    }
  },
  
  "rules": [
    "CCTV 화면은 3초 이상 응시하지 말 것",
    "어둠 속의 눈과 마주치지 말 것",
    "증거를 인멸하지 말 것",
    "출구 앞에서 뒤를 돌아보지 말 것"
  ],
  "shardRoutes": {
    "cam": ["n3", "n7"],
    "map": ["n5", "n11"],
    "blood": ["n18", "n1"]
  },
  "nodes": [
    {
      "id": "n1",
      "room": 1,
      "bg": "r1_bg_lobby_01",
      "text": "눈을 떴다. 어두운 로비다. 형광등이 깜빡이고, 어딘가에서 물 떨어지는 소리가 들린다. 앞에 세 개의 문이 있다.",
      "choices": [
        {
          "label": "왼쪽 복도로 간다 (기록실 방향)",
          "type": "goto",
          "next": "n2",
          "hint": "17번 파일이 있을 수 있다"
        },
        {
          "label": "CCTV실 문을 연다",
          "type": "goto",
          "next": "n3",
          "hint": "위험하지만 정보를 얻을 수 있다"
        },
        {
          "label": "엘리베이터를 확인한다",
          "type": "goto",
          "next": "n4"
        },
        {
          "label": "바닥의 핏자국을 만져본다",
          "type": "death",
          "deathType": "TRAP",
          "deathMsg": "손을 대자마자 바닥이 꺼졌다. 무언가가 너를 끌어당겼다.",
          "globalEffect": { "tracks": { "taint": 1 } }
        }
      ]
    },
    {
      "id": "n2",
      "room": 1,
      "bg": "r1_bg_corridor_01",
      "text": "복도는 끝이 보이지 않는다. 왼쪽과 오른쪽에 문이 있고, 정면 끝에 희미한 빛이 새어 나온다.",
      "choices": [
        {
          "label": "왼쪽 문을 연다 (기록실)",
          "type": "goto",
          "next": "n5"
        },
        {
          "label": "오른쪽 문을 연다",
          "type": "death",
          "deathType": "TRAP",
          "deathMsg": "문이 열리자 칼날이 목을 스쳤다. 함정이었다."
        },
        {
          "label": "정면의 빛을 향해 간다",
          "type": "goto",
          "next": "n6"
        }
      ]
    },
    {
      "id": "n3",
      "room": 1,
      "bg": "r1_bg_cctvroom_01",
      "text": "모니터들이 희미하게 빛난다. 화면에 무언가 움직이는 게 보인다. 서류함도 눈에 띈다. [CCTV 조각 획득 가능 구역]",
      "onEnter": { "setFlags": ["visited_cctv"], "canObtain": "cam" },
      "choices": [
        {
          "label": "모니터 화면을 자세히 본다",
          "type": "death",
          "deathType": "RULE_VIOLATION",
          "deathMsg": "규칙: CCTV 화면은 3초 이상 응시하지 말 것. 너무 오래 봤다.",
          "globalEffect": { "tracks": { "taint": 2 } }
        },
        {
          "label": "모니터 전원을 내린다",
          "type": "goto",
          "next": "n7",
          "effects": { "setFlags": ["cctv_off", "obtained_cam_shard"], "threat": -1, "addItems": ["cam_shard"] },
          "globalEffect": { "tracks": { "purity": 1 } }
        },
        {
          "label": "서류함을 뒤진다",
          "type": "goto",
          "next": "n8"
        }
      ]
    },
    {
      "id": "n4",
      "room": 1,
      "bg": "r1_bg_elevator_01",
      "text": "엘리베이터는 멈춰 있다. 문 틈 사이로 칠흑 같은 어둠이 보인다. 버튼이 희미하게 빛난다.",
      "choices": [
        {
          "label": "버튼을 누른다",
          "type": "death",
          "deathType": "TRAP",
          "deathMsg": "문이 열리고, 안에서 손이 뻗어 나와 너를 끌어당겼다."
        },
        {
          "label": "계단을 찾는다",
          "type": "goto",
          "next": "n9"
        },
        {
          "label": "틈으로 안을 들여다본다",
          "type": "goto",
          "next": "n10"
        }
      ]
    },
    {
      "id": "n5",
      "room": 1,
      "bg": "r1_bg_archive_01",
      "text": "기록실이다. 서류가 산더미처럼 쌓여 있다. '17번 파일'이라고 적힌 라벨이 눈에 띈다. [지도 조각 획득 가능 구역]",
      "onEnter": { "canObtain": "map" },
      "choices": [
        {
          "label": "17번 파일을 찾는다",
          "type": "goto",
          "next": "n11"
        },
        {
          "label": "찢어진 서류를 읽는다",
          "type": "goto",
          "next": "n12"
        },
        {
          "label": "벽을 살펴 숨겨진 문을 찾는다",
          "type": "goto",
          "next": "n13"
        }
      ]
    },
    {
      "id": "n6",
      "room": 1,
      "bg": "r1_bg_door_01",
      "text": "정면의 문 앞에 섰다. 문 아래로 빛이 새어 나오고, 문에서 냉기가 느껴진다.",
      "choices": [
        {
          "label": "조용히 문을 연다",
          "type": "goto",
          "next": "n14"
        },
        {
          "label": "노크한다",
          "type": "death",
          "deathType": "TRAP",
          "deathMsg": "노크 소리에 반응한 무언가가 문을 부수고 나왔다."
        },
        {
          "label": "문틈으로 안을 본다",
          "type": "goto",
          "next": "n14"
        }
      ]
    },
    {
      "id": "n7",
      "room": 1,
      "bg": "r1_bg_cctvroom_01",
      "text": "모니터가 꺼지고 방이 어두워졌다. 안도감이 든다. 뒤쪽에 문이 하나 더 있다. [CCTV 비활성화됨 - CCTV 조각 획득!]",
      "onEnter": { "obtainShard": "cam" },
      "choices": [
        {
          "label": "뒤쪽 문으로 나간다",
          "type": "goto",
          "next": "n15"
        },
        {
          "label": "어둠 속에서 서류함을 뒤진다",
          "type": "goto",
          "next": "n8"
        },
        {
          "label": "잠시 숨을 고른다",
          "type": "goto",
          "next": "n15",
          "effects": { "threat": -1 }
        }
      ]
    },
    {
      "id": "n8",
      "room": 1,
      "bg": "r1_bg_archive_01",
      "text": "서류함에서 '관측 기록'이라고 적힌 파일을 발견했다. 표지에 '열람 금지'라고 적혀 있다. 마지막 페이지에 '거울 앞에서 눈을 마주치지 말 것'이라는 메모가 적혀 있다.",
      "onEnter": { "setFlags": ["knows_mirror_rule"] },
      "choices": [
        {
          "label": "파일을 자세히 읽는다",
          "type": "goto",
          "next": "n16"
        },
        {
          "label": "파일을 가방에 넣고 간다",
          "type": "goto",
          "next": "n15",
          "effects": { "addItems": ["observation_record"], "setFlags": ["has_record"] }
        },
        {
          "label": "파일을 태운다",
          "type": "death",
          "deathType": "RULE_VIOLATION",
          "deathMsg": "규칙: 증거를 인멸하지 말 것. 불꽃이 손을 타고 올라왔다.",
          "globalEffect": { "tracks": { "taint": 3 } }
        }
      ]
    },
    {
      "id": "n9",
      "room": 1,
      "bg": "r1_bg_stair_01",
      "text": "계단을 발견했다. 위로 올라가는 길이 있고, 벽에 무언가 적혀 있다.",
      "choices": [
        {
          "label": "위로 올라간다",
          "type": "goto",
          "next": "n15"
        },
        {
          "label": "벽의 글씨를 읽는다",
          "type": "goto",
          "next": "n17"
        },
        {
          "label": "아래로 내려간다",
          "type": "death",
          "deathType": "TRAP",
          "deathMsg": "계단이 무너지며 끝없는 어둠 속으로 떨어졌다."
        }
      ]
    },
    {
      "id": "n10",
      "room": 1,
      "bg": "r1_bg_elevator_01",
      "text": "틈 사이로 아래를 봤다. 깊은 어둠 속에서... 눈이 올려다보고 있었다.",
      "onEnter": { "threat": 2 },
      "choices": [
        {
          "label": "눈을 마주친다",
          "type": "death",
          "deathType": "RULE_VIOLATION",
          "deathMsg": "규칙: 어둠 속의 눈과 마주치지 말 것.",
          "globalEffect": { "tracks": { "taint": 2 } }
        },
        {
          "label": "고개를 돌리고 계단으로 간다",
          "type": "goto",
          "next": "n9",
          "globalEffect": { "tracks": { "purity": 1 } }
        },
        {
          "label": "눈을 감고 뒤로 물러난다",
          "type": "goto",
          "next": "n9",
          "effects": { "threat": -1 },
          "globalEffect": { "tracks": { "purity": 1 } }
        }
      ]
    },
    {
      "id": "n11",
      "room": 1,
      "bg": "r1_bg_archive_01",
      "text": "17번 파일을 찾았다. 안에 '탈출 경로'가 그려진 지도가 있다. 지도 여백에 '2번 방의 거울을 조심하라'는 메모가 있다. [지도 조각 획득!]",
      "onEnter": { "addItems": ["map_17", "map_shard"], "setFlags": ["has_map", "knows_mirror_rule", "obtained_map_shard"], "obtainShard": "map" },
      "choices": [
        {
          "label": "지도를 따라간다",
          "type": "goto",
          "next": "n15"
        },
        {
          "label": "지도를 외우고 다른 파일도 본다",
          "type": "goto",
          "next": "n12"
        },
        {
          "label": "지도의 X 표시로 간다",
          "type": "goto",
          "next": "n18"
        }
      ]
    },
    {
      "id": "n12",
      "room": 1,
      "bg": "r1_bg_archive_01",
      "text": "찢어진 서류에는 같은 문장이 반복되어 있다. '절대 돌아보지 마 절대 돌아보지 마 절대 돌아보지 마...'",
      "onEnter": { "setFlags": ["knows_no_lookback"] },
      "choices": [
        {
          "label": "뒤를 돌아본다",
          "type": "death",
          "deathType": "RULE_VIOLATION",
          "deathMsg": "뒤를 돌아보는 순간, 무언가가 거기 있었다.",
          "globalEffect": { "tracks": { "taint": 1 } }
        },
        {
          "label": "앞만 보고 나간다",
          "type": "goto",
          "next": "n15",
          "globalEffect": { "tracks": { "purity": 1 } }
        },
        {
          "label": "서류를 주머니에 넣고 나간다",
          "type": "goto",
          "next": "n15",
          "effects": { "addItems": ["torn_document"] }
        }
      ]
    },
    {
      "id": "n13",
      "room": 1,
      "bg": "r1_bg_voidhall_01",
      "text": "벽 뒤에 숨겨진 통로를 발견했다. 안에서 차가운 바람이 불어온다.",
      "choices": [
        {
          "label": "통로로 들어간다",
          "type": "goto",
          "next": "n18"
        },
        {
          "label": "바람의 방향을 확인하고 들어간다",
          "type": "goto",
          "next": "n18",
          "effects": { "setFlags": ["checked_wind"] }
        },
        {
          "label": "입구에 표시를 남기고 들어간다",
          "type": "goto",
          "next": "n18",
          "effects": { "setFlags": ["marked_entrance"] }
        }
      ]
    },
    {
      "id": "n14",
      "room": 1,
      "bg": "r1_bg_infirmary_01",
      "text": "의무실이다. 침대에 누군가 누워 있다... 아니, 있었던 것 같다. 시트에 사람 모양의 자국이 있다.",
      "choices": [
        {
          "label": "침대를 조사한다",
          "type": "goto",
          "next": "n15",
          "effects": { "setFlags": ["searched_bed"] }
        },
        {
          "label": "약품 캐비닛을 연다",
          "type": "goto",
          "next": "n15",
          "effects": { "addItems": ["medical_kit"] }
        },
        {
          "label": "창문을 확인한다",
          "type": "death",
          "deathType": "TRAP",
          "deathMsg": "창문 너머로 손을 뻗자 유리가 깨지며 무언가가 끌어당겼다."
        }
      ]
    },
    {
      "id": "n15",
      "room": 1,
      "bg": "r1_bg_stair_01",
      "text": "계단 위에 빛이 보인다. 출구가 가까워지고 있다. 하지만 뒤에서 발소리가 들린다.",
      "choices": [
        {
          "label": "빛을 향해 달린다",
          "type": "goto",
          "next": "n19",
          "requires": { "flags": ["has_map"] },
          "requiresHint": "(지도가 필요합니다)"
        },
        {
          "label": "천천히 주변을 확인하며 간다",
          "type": "goto",
          "next": "n19"
        },
        {
          "label": "뒤의 발소리를 확인한다",
          "type": "death",
          "deathType": "RULE_VIOLATION",
          "deathMsg": "규칙: 출구 앞에서 뒤를 돌아보지 말 것.",
          "globalEffect": { "tracks": { "taint": 2 } }
        }
      ]
    },
    {
      "id": "n16",
      "room": 1,
      "bg": "r1_bg_archive_01",
      "text": "관측 기록에는 이상한 실험에 대한 내용이 적혀 있다. 읽을수록 머리가 아프다. 문서 끝에 '거울 속의 존재'에 대한 경고가 있다.",
      "onEnter": { "setFlags": ["knows_mirror_entity"], "threat": 1 },
      "choices": [
        {
          "label": "끝까지 읽는다",
          "type": "death",
          "deathType": "FORBIDDEN_KNOWLEDGE",
          "deathMsg": "너무 많이 알게 되었다. '그들'이 너를 찾아왔다.",
          "globalEffect": { "tracks": { "truth": 1, "taint": 2 } }
        },
        {
          "label": "파일을 덮고 나간다",
          "type": "goto",
          "next": "n15"
        },
        {
          "label": "핵심만 기억하고 파일을 숨긴다",
          "type": "goto",
          "next": "n15",
          "effects": { "setFlags": ["knows_core_info"], "addItems": ["hidden_file_location"] },
          "globalEffect": { "tracks": { "truth": 1 } }
        }
      ]
    },
    {
      "id": "n17",
      "room": 1,
      "bg": "r1_bg_stair_01",
      "text": "벽에 적힌 글씨: '3층으로 가지 마. 그가 거기 있다.'",
      "onEnter": { "setFlags": ["knows_3f_danger"] },
      "choices": [
        {
          "label": "3층으로 간다",
          "type": "death",
          "deathType": "WARNING_IGNORED",
          "deathMsg": "경고를 무시했다. 그가 거기 있었다."
        },
        {
          "label": "2층에서 출구를 찾는다",
          "type": "goto",
          "next": "n15",
          "globalEffect": { "tracks": { "purity": 1 } }
        },
        {
          "label": "메시지를 남기고 2층으로 간다",
          "type": "goto",
          "next": "n15",
          "effects": { "setFlags": ["left_message"] },
          "globalEffect": { "tracks": { "truth": 1 } }
        }
      ]
    },
    {
      "id": "n18",
      "room": 1,
      "bg": "r1_bg_altar_01",
      "text": "제단이 있는 방이다. 여긴 원래 이런 방이 아니었다. 벽에 이상한 문양이 그려져 있다. [제단 조각 획득 가능 구역 - 위험!]",
      "onEnter": { "threat": 3, "canObtain": "blood" },
      "choices": [
        {
          "label": "제단에 다가간다",
          "type": "death",
          "deathType": "SACRIFICE",
          "deathMsg": "제단이 너를 받아들였다. 이제 너는 이곳의 일부다.",
          "globalEffect": { "tracks": { "sacrifice": 3, "taint": 1 } }
        },
        {
          "label": "벽의 문양을 해독한다",
          "type": "goto",
          "next": "n15",
          "effects": { "setFlags": ["decoded_symbols", "obtained_blood_shard"], "threat": -1, "addItems": ["blood_shard"] },
          "globalEffect": { "tracks": { "truth": 2 } },
          "onSuccess": { "obtainShard": "blood" }
        },
        {
          "label": "다른 출구를 찾는다",
          "type": "goto",
          "next": "n15"
        }
      ]
    },
    {
      "id": "n19",
      "room": 1,
      "bg": "r1_bg_lobby_01",
      "text": "문을 열고 나왔다. 눈부신 빛. 하지만... 여긴 또 다른 로비다. 앞에 문이 보인다. 끝이 아니다. [1번 방 통과] 조각을 가지고 있다면 기부할 수 있습니다.",
      "isExit": true,
      "canDeposit": true,
      "choices": [
        {
          "label": "조각을 기부한다",
          "type": "deposit",
          "next": "n20",
          "requires": { "hasAnyShard": true },
          "requiresHint": "(조각이 필요합니다)",
          "globalEffect": { "tracks": { "sacrifice": 1, "purity": 1 } }
        },
        {
          "label": "조각을 가지고 앞으로 나아간다",
          "type": "goto",
          "next": "n20"
        },
        {
          "label": "잠시 숨을 고르고 간다",
          "type": "goto",
          "next": "n20",
          "effects": { "threat": -1 }
        }
      ]
    },
    {
      "id": "n20",
      "room": 2,
      "bg": "r1_bg_corridor_01",
      "text": "[2번 방 진입] 복도가 이어진다. 이번엔 벽에 거울이 걸려 있다. 거울 속에 무언가가 비친다.",
      "choices": [
        {
          "label": "거울을 자세히 본다",
          "type": "death",
          "deathType": "TRAP",
          "deathMsg": "거울 속의 무언가가 손을 뻗어 너를 끌어당겼다.",
          "globalEffect": { "tracks": { "taint": 2 } }
        },
        {
          "label": "거울을 피해 지나간다",
          "type": "goto",
          "next": "n21",
          "globalEffect": { "tracks": { "purity": 1 } }
        },
        {
          "label": "거울을 깨뜨린다",
          "type": "death",
          "deathType": "RULE_VIOLATION",
          "deathMsg": "규칙: 거울을 깨지 말 것. 파편이 너를 덮쳤다.",
          "globalEffect": { "tracks": { "taint": 1, "betrayal": 1 } }
        }
      ]
    },
    {
      "id": "n21",
      "room": 2,
      "bg": "r1_bg_door_01",
      "text": "복도 끝에 두 개의 문이 있다. 왼쪽 문에서는 소리가, 오른쪽 문에서는 냄새가 난다.",
      "choices": [
        {
          "label": "왼쪽 문을 연다",
          "type": "goto",
          "next": "n22"
        },
        {
          "label": "오른쪽 문을 연다",
          "type": "death",
          "deathType": "TRAP",
          "deathMsg": "문을 여는 순간 독가스가 뿜어져 나왔다."
        },
        {
          "label": "두 문 사이의 벽을 확인한다",
          "type": "goto",
          "next": "n22",
          "effects": { "setFlags": ["found_secret_panel"] }
        }
      ]
    },
    {
      "id": "n22",
      "room": 2,
      "bg": "r1_bg_stair_01",
      "text": "계단이 또 나타났다. 위에서 희미한 빛이 보인다. 이번엔 진짜 출구일까?",
      "choices": [
        {
          "label": "계단을 올라간다",
          "type": "goto",
          "next": "n23"
        },
        {
          "label": "조심스럽게 올라간다",
          "type": "goto",
          "next": "n23",
          "effects": { "threat": -1 }
        },
        {
          "label": "계단 밑을 확인한다",
          "type": "death",
          "deathType": "TRAP",
          "deathMsg": "계단 밑에서 손이 뻗어 나와 발목을 잡았다."
        }
      ]
    },
    {
      "id": "n23",
      "room": 2,
      "bg": "r1_bg_lobby_01",
      "text": "[2번 방 통과] 또 다른 공간이 펼쳤다. 릴레이는 계속된다... (현재 베타: 여기까지 구현됨)",
      "isExit": true,
      "canDeposit": true,
      "choices": [
        {
          "label": "조각을 기부하고 계속한다 (준비 중)",
          "type": "deposit_and_end",
          "requires": { "hasAnyShard": true },
          "requiresHint": "(조각이 필요합니다)",
          "deathType": "BETA_END",
          "deathMsg": "베타 버전의 끝에 도달했습니다. 조각이 기부되었습니다!"
        },
        {
          "label": "계속 진행한다 (준비 중)",
          "type": "death",
          "deathType": "BETA_END",
          "deathMsg": "베타 버전의 끝에 도달했습니다. 더 많은 방이 추가될 예정입니다!"
        }
      ]
    }
  ]
}

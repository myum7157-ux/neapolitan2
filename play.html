<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>나폴리탄 릴레이</title>
  <link rel="stylesheet" href="/styles/app.css" />
</head>
<body class="page play">

  <header class="topbar">
    <div class="brand">
      <div class="chip">릴레이</div>
      <div class="chip muted" id="phaseChip">로비</div>
    </div>
    <nav class="tabs">
      <button class="tab active" data-tab="lobby">로비</button>
      <button class="tab" data-tab="wills">유언</button>
      <button class="tab" data-tab="death">사망기록</button>
      <button class="tab" data-tab="rank">랭킹</button>
    </nav>
    <div class="right">
      <button id="btnLogout" class="btn">나가기</button>
    </div>
  </header>

  <main class="main">
    <!-- 로비 -->
    <section id="tab-lobby" class="tabPane active">
      <!-- 밴 상태 -->
      <div class="banNotice hidden" id="banNotice">
        <div class="title">🚫 24시간 참가 제한</div>
        <div class="countdown" id="banCountdown">--:--:--</div>
      </div>

      <!-- 대기열 -->
      <div class="lobbyCard">
        <div class="queueInfo">
          <div class="queueItem">
            <div class="num" id="queueTotal">0</div>
            <div class="lbl">총 대기</div>
          </div>
          <div class="queueItem">
            <div class="num" id="queuePosition">-</div>
            <div class="lbl">내 순번</div>
          </div>
          <div class="queueItem">
            <div class="num" id="queuePlaying">0</div>
            <div class="lbl">플레이 중</div>
          </div>
        </div>
        <div class="row">
          <button id="btnStartRun" class="btn primary">시작하기</button>
          <button id="btnMiniFromLobby" class="btn">미니게임</button>
        </div>
      </div>

      <!-- 게임 화면 -->
      <div class="roomCard" id="roomCard">
        <!-- 상태 바 -->
        <div class="statBar">
          <div class="statItem">
            <div class="icon">🚪</div>
            <div class="label">방</div>
            <div class="value" id="statRoom">1</div>
          </div>
          <div class="statItem">
            <div class="icon">👣</div>
            <div class="label">단계</div>
            <div class="value" id="statStep">0</div>
          </div>
          <div class="statItem">
            <div class="icon">⏱️</div>
            <div class="label">생존</div>
            <div class="value" id="statTime">0:00</div>
          </div>
        </div>

        <img id="sceneImage" class="sceneImage" src="" alt="장면" />

        <div class="storyContent">
          <div class="storyText" id="storyText">시작하기 버튼을 눌러 릴레이에 참가하세요.</div>
          <div class="choices" id="choices"></div>
        </div>
      </div>
    </section>

    <!-- 유언 -->
    <section id="tab-wills" class="tabPane">
      <div class="feedCard">
        <div class="feedHeader">
          <div class="feedTitle">유언 피드</div>
          <div class="chip muted" id="willCount">0</div>
        </div>
        <div class="feedList" id="willList">
          <div class="emptyState">아직 유언이 없습니다</div>
        </div>
      </div>
    </section>

    <!-- 사망기록 -->
    <section id="tab-death" class="tabPane">
      <div class="feedCard">
        <div class="feedHeader">
          <div class="feedTitle">사망 기록</div>
          <div class="chip muted" id="deathCount">0</div>
        </div>
        <div class="feedList" id="deathList">
          <div class="emptyState">아직 사망 기록이 없습니다</div>
        </div>
      </div>
    </section>

    <!-- 랭킹 -->
    <section id="tab-rank" class="tabPane">
      <div class="feedCard">
        <div class="feedHeader">
          <div class="feedTitle">랭킹 (진행 단계 기준)</div>
        </div>
        <div class="feedList" id="rankList">
          <div class="emptyState">아직 랭킹 데이터가 없습니다</div>
        </div>
      </div>
    </section>
  </main>

  <!-- 사망 모달 -->
  <div id="deathModal" class="modal hidden">
    <div class="modalInner">
      <div class="modalHeader">
        <div class="modalTitle">💀 사망 보고서</div>
      </div>
      
      <div class="deathCardWrap">
        <img id="deathBgImg" class="bgImg" src="" alt="사망" />
        <div class="overlay">
          <div class="deathType" id="deathType">함정</div>
          <div class="deathMsg" id="deathMsg">당신은 죽었습니다</div>
        </div>
      </div>

      <div class="willInputSection">
        <div class="willInputLabel">다음 플레이어에게 남길 유언</div>
        <textarea id="willInput" class="willInput" placeholder="힌트, 경고, 또는 속임수..." maxlength="100"></textarea>
        <div class="charCount"><span id="charCount">0</span>/100</div>
      </div>

      <div class="modalFooter">
        <button id="btnSkipWill" class="btn">건너뛰기</button>
        <button id="btnSubmitWill" class="btn primary">확인</button>
      </div>
    </div>
  </div>

  <!-- 유언카드 공유 모달 -->
  <div id="shareModal" class="shareModal hidden">
    <div class="shareModalInner">
      <div class="shareTitle">📤 사망 기록 공유</div>
      
      <div class="willCardPreview">
        <div class="cardHeader" id="previewHeader">사망 보고서</div>
        <div class="cardBody" id="previewBody">(유언 없음)</div>
        <div class="cardFooter" id="previewFooter">1번 방 · 0단계 · 함정 · 0:00</div>
      </div>
      
      <div class="shareButtons">
        <button id="btnDownloadCard" class="btn primary">이미지 저장</button>
        <button id="btnCopyLink" class="btn">링크 복사</button>
        <button id="btnCloseShare" class="btn">닫기</button>
      </div>
    </div>
  </div>

  <canvas id="willCardCanvas" style="display:none"></canvas>

  <script src="/src/app.js" type="module"></script>
</body>
</html>
